<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-tutorial-advanced/Quasi_experimental_Analysis" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Causal Inference |  </title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://llenar70.github.io/allye-doc/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://llenar70.github.io/allye-doc/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://llenar70.github.io/allye-doc/docs/tutorial-advanced/Quasi_experimental_Analysis"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Causal Inference |  "><meta data-rh="true" name="description" content="Product: Allye A/B Test Analysis"><meta data-rh="true" property="og:description" content="Product: Allye A/B Test Analysis"><link data-rh="true" rel="icon" href="/allye-doc/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://llenar70.github.io/allye-doc/docs/tutorial-advanced/Quasi_experimental_Analysis"><link data-rh="true" rel="alternate" href="https://llenar70.github.io/allye-doc/docs/tutorial-advanced/Quasi_experimental_Analysis" hreflang="en"><link data-rh="true" rel="alternate" href="https://llenar70.github.io/allye-doc/docs/tutorial-advanced/Quasi_experimental_Analysis" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Handson Tutorial","item":"https://llenar70.github.io/allye-doc/docs/category/handson-tutorial"},{"@type":"ListItem","position":2,"name":"Causal Inference","item":"https://llenar70.github.io/allye-doc/docs/tutorial-advanced/Quasi_experimental_Analysis"}]}</script><link rel="alternate" type="application/rss+xml" href="/allye-doc/blog/rss.xml" title="  RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/allye-doc/blog/atom.xml" title="  Atom Feed"><link rel="stylesheet" href="/allye-doc/assets/css/styles.f2bd34e1.css">
<script src="/allye-doc/assets/js/runtime~main.a2aa3b97.js" defer="defer"></script>
<script src="/allye-doc/assets/js/main.88836537.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/allye-doc/img/6852cb04a48fccea34beed5e_allye_logo.png"><link rel="preload" as="image" href="/allye-doc/assets/images/course2_marketer-83aee1059c84bec21e7c3af3cb4cabd9.png"><link rel="preload" as="image" href="/allye-doc/assets/images/course2_selection_bias-9b52b6ecaca95952119077e1ac409d0e.png"><link rel="preload" as="image" href="/allye-doc/assets/images/course2_psm_concept-17c89892feccf94292b80cde54f482fb.png"><link rel="preload" as="image" href="/allye-doc/assets/images/course2_get_csv-9b5a626a5e736b3c27e49e0f778f4b94.png"><link rel="preload" as="image" href="/allye-doc/assets/images/course2_eda_before-6c5fd24fb5215ac04f502b832aa598e3.png"><link rel="preload" as="image" href="/allye-doc/assets/images/course2_psm_widget-5ac8b74ebcabd151dd64f2a96ac89ca8.png"><link rel="preload" as="image" href="/allye-doc/assets/images/course2_configure_psm_widget-ad910860604df0d853f36767d5f0b98d.png"><link rel="preload" as="image" href="/allye-doc/assets/images/course2_psm_result-24e6036ec8cd50b5f2b0eafebeb6ce99.png"><link rel="preload" as="image" href="/allye-doc/assets/images/course2_abtest-a877482d615583390ff113f434c64e64.png"><link rel="preload" as="image" href="/allye-doc/assets/images/course2_abtest_result-64f8e80616220a1d315637b3669c3378.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.ai-allye.com/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/allye-doc/img/6852cb04a48fccea34beed5e_allye_logo.png" alt="Allye Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/allye-doc/img/6852cb04a48fccea34beed5e_allye_logo.png" alt="Allye Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"> </b></a><a class="navbar__item navbar__link" href="/allye-doc/docs/get-started/allye-quickstart-for-engineers">Quickstart</a><a class="navbar__item navbar__link" href="/allye-doc/docs/allye/adv-tutorial-overview">Tutorial</a><a class="navbar__item navbar__link" href="/allye-doc/docs/products/allye-base">Product Details</a><a class="navbar__item navbar__link" href="/allye-doc/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/allye-doc/docs/welcome"><span title="Allye Documentation" class="linkLabel_WmDU">Allye Documentation</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/allye-doc/docs/category/get-started"><span title="Get Started" class="categoryLinkLabel_W154">Get Started</span></a><button aria-label="Collapse sidebar category &#x27;Get Started&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/allye-doc/docs/get-started/allye-quickstart-for-engineers"><span title="Quickstart for Engineers" class="linkLabel_WmDU">Quickstart for Engineers</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/allye-doc/docs/get-started/allye-quickstart"><span title="Quickstart" class="linkLabel_WmDU">Quickstart</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/allye-doc/docs/get-started/allye-connected-visualization"><span title="Connected Visualization" class="linkLabel_WmDU">Connected Visualization</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/allye-doc/docs/get-started/allye-changecolor"><span title="Change Color &amp; Font" class="linkLabel_WmDU">Change Color &amp; Font</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/allye-doc/docs/get-started/allye-save"><span title="Save" class="linkLabel_WmDU">Save</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/allye-doc/docs/get-started/allye-built-in-python"><span title="Built-in Python" class="linkLabel_WmDU">Built-in Python</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/allye-doc/docs/category/handson-tutorial"><span title="Handson Tutorial" class="categoryLinkLabel_W154">Handson Tutorial</span></a><button aria-label="Collapse sidebar category &#x27;Handson Tutorial&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/allye-doc/docs/allye/adv-tutorial-overview"><span title="Tutorial Overview" class="linkLabel_WmDU">Tutorial Overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/allye-doc/docs/tutorial-advanced/EDA"><span title="Exploratory data analysis" class="linkLabel_WmDU">Exploratory data analysis</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/allye-doc/docs/allye/ab-test-analysis"><span title="A/B Test Result Analysis" class="linkLabel_WmDU">A/B Test Result Analysis</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/allye-doc/docs/tutorial-advanced/Survey_Analysis"><span title="Survey Analysis" class="linkLabel_WmDU">Survey Analysis</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/allye-doc/docs/tutorial-advanced/Quasi_experimental_Analysis"><span title="Causal Inference" class="linkLabel_WmDU">Causal Inference</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/allye-doc/docs/tutorial-advanced/Machine_Learning_Prototyping"><span title="Machine learning predictive model prototyping" class="linkLabel_WmDU">Machine learning predictive model prototyping</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/allye-doc/docs/tutorial-advanced/Notebook Manager"><span title="Notebooks Manager" class="linkLabel_WmDU">Notebooks Manager</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/allye-doc/docs/category/product-details"><span title="Product Details" class="categoryLinkLabel_W154">Product Details</span></a><button aria-label="Collapse sidebar category &#x27;Product Details&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/allye-doc/docs/products/allye-base"><span title="Allye Base" class="linkLabel_WmDU">Allye Base</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/allye-doc/docs/products/Allye_ABTest_Analysis"><span title="Allye A/B Test Analysis" class="linkLabel_WmDU">Allye A/B Test Analysis</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/allye-doc/docs/products/Allye_Survey_Analysis"><span title="Allye Survey Analysis" class="linkLabel_WmDU">Allye Survey Analysis</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/allye-doc/docs/category/agent-allye"><span title="Agent Allye" class="categoryLinkLabel_W154">Agent Allye</span></a><button aria-label="Collapse sidebar category &#x27;Agent Allye&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/allye-doc/docs/agent/Agent_Overview"><span title="Overview &amp; Quickstart" class="linkLabel_WmDU">Overview &amp; Quickstart</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/allye-doc/docs/agent/Canvas_Agent_Settings"><span title="Canvas Agent Settings" class="linkLabel_WmDU">Canvas Agent Settings</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/allye-doc/docs/agent/Notebook_Agent_Settings"><span title="Notebook Agent Settings" class="linkLabel_WmDU">Notebook Agent Settings</span></a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/allye-doc/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/allye-doc/docs/category/handson-tutorial"><span>Handson Tutorial</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Causal Inference</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Causal Inference</h1></header>
<div class="doc-tag-row"><span class="doc-tag doc-tag--green">Product: Allye A/B Test Analysis</span></div>
<p><em>Imagine you&#x27;re a marketer who launched a newsletter. While it&#x27;s a great tool for engagement, you&#x27;re aware that sending it too frequently can bother users and harm the overall experience. You see that subscribers tend to buy more products, but you can&#x27;t be sure if the newsletter is <em>causing</em> this increase. Is it driving sales, or just annoying your customers and leading to opt-outs? This is a classic problem that arises from using <strong>observational data</strong>.</em></p>
<p>Running an RCT isn&#x27;t always possible. So, what happens when you can&#x27;t run an experiment but still need to understand the impact of your actions?</p>
<p align="center"><img src="/allye-doc/assets/images/course2_marketer-83aee1059c84bec21e7c3af3cb4cabd9.png" alt="Marketer&#x27;s concern" style="width:40%;object-fit:contain"></p>
<p>In this case study, you&#x27;ll learn how to use <strong>Propensity Score Matching (PSM)</strong>, a powerful technique to untangle these effects and estimate the true causal impact when an RCT isn&#x27;t an option.</p>
<p>Specifically, you will practice the following steps:</p>
<ul>
<li class="">Understand the challenge of <strong>selection bias</strong> in observational data.</li>
<li class="">Learn the intuition behind <strong>Propensity Score Matching (PSM)</strong> and how it creates a &quot;fair&quot; comparison.</li>
<li class=""><strong>Design an analysis</strong> to measure the impact of a newsletter on user spending and opt-out rates.</li>
<li class=""><strong>Use Allye</strong> to implement PSM and interpret the results.</li>
<li class="">Learn the <strong>real-world limitations</strong> of PSM.</li>
</ul>
<p>By the end of this session, you&#x27;ll have a method to find causal insights from the data you already have.</p>
<br>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-challenge-apples-to-oranges-comparison">The Challenge: Apples to Oranges Comparison<a href="#the-challenge-apples-to-oranges-comparison" class="hash-link" aria-label="Direct link to The Challenge: Apples to Oranges Comparison" title="Direct link to The Challenge: Apples to Oranges Comparison" translate="no">​</a></h2>
<p>The biggest hurdle with observational data is <strong>selection bias</strong>. Unlike in an RCT where users are randomly assigned to groups, in the real world, users <em>select themselves</em> into groups.</p>
<p>For example, users who choose to subscribe to a newsletter are likely different from those who don&#x27;t. They might be more interested in your brand, more tech-savvy, or have higher incomes. These underlying differences are <strong>confounding factors</strong>.</p>
<p align="center"><img src="/allye-doc/assets/images/course2_selection_bias-9b52b6ecaca95952119077e1ac409d0e.png" alt="Selection Bias" style="width:75%;object-fit:contain"></p>
<p>If you simply compare the average spending of subscribers and non-subscribers, you&#x27;re making an &quot;apples to oranges&quot; comparison. You can&#x27;t tell if a difference in spending is due to the newsletter itself or due to these pre-existing differences. Your conclusion will be biased and unreliable.</p>
<br>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-solution-propensity-score-matching-psm">The Solution: Propensity Score Matching (PSM)<a href="#the-solution-propensity-score-matching-psm" class="hash-link" aria-label="Direct link to The Solution: Propensity Score Matching (PSM)" title="Direct link to The Solution: Propensity Score Matching (PSM)" translate="no">​</a></h2>
<p>So how can we create a fair comparison? This is where Propensity Score Matching comes in.</p>
<p>The core idea of PSM is to find, for every subscriber (the &quot;treatment group&quot;), a non-subscriber (the &quot;control group&quot;) who looked <strong>almost identical</strong> <em>before</em> they decided to subscribe. If we can create a control group that is perfectly comparable to our treatment group across all key characteristics (like age, past purchases, browsing activity), then any difference in their future outcomes can be more confidently attributed to the newsletter.</p>
<p align="center"><img src="/allye-doc/assets/images/course2_psm_concept-17c89892feccf94292b80cde54f482fb.png" alt="PSM Concept" style="width:75%;object-fit:contain"></p>
<p><strong>How does it work?</strong></p>
<ol>
<li class="">
<p><strong>Calculate the Propensity Score</strong>: First, we build a statistical model (usually logistic regression) to calculate the &quot;propensity score&quot; for every single user. The propensity score is the probability of a user subscribing to the newsletter, given their characteristics (e.g., age, region, past behavior).</p>
<ul>
<li class=""><em>A user with a high score is someone who, based on their profile, was very likely to subscribe.</em></li>
<li class=""><em>A user with a low score was unlikely to subscribe.</em></li>
</ul>
</li>
<li class="">
<p><strong>Match Users</strong>: Next, PSM takes each user in the treatment group (subscribers) and finds a user in the control group (non-subscribers) who has a very similar propensity score. It&#x27;s like finding a &quot;statistical twin.&quot;</p>
</li>
</ol>
<p>By doing this for everyone in the treatment group, we create a new, smaller control group that is well-balanced with the treatment group. We have turned an &quot;apples to oranges&quot; comparison into a much fairer &quot;apples to apples&quot; comparison. Now, we can analyze the difference in outcomes between these two matched groups to estimate the causal effect of the newsletter.</p>
<br>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="designing-the-analysis-does-a-newsletter-increase-sales-or-just-annoy-users">Designing the Analysis: Does a Newsletter Increase Sales or Just Annoy Users?<a href="#designing-the-analysis-does-a-newsletter-increase-sales-or-just-annoy-users" class="hash-link" aria-label="Direct link to Designing the Analysis: Does a Newsletter Increase Sales or Just Annoy Users?" title="Direct link to Designing the Analysis: Does a Newsletter Increase Sales or Just Annoy Users?" translate="no">​</a></h2>
<p>You are a marketer for an e-commerce site. You want to know if subscribing to your weekly newsletter causes an increase in customer spending, or if it&#x27;s actually driving users away.</p>
<p><strong>1. Clarifying the Hypothesis</strong></p>
<ul>
<li class=""><strong>Hypothesis</strong>: Subscribing to the newsletter does not significantly increase user spending but does increase the rate at which users opt-out of communications.</li>
<li class=""><strong>Causal Relationships to Verify</strong>:<!-- -->
<ol>
<li class="">Does subscribing to the newsletter (cause) lead to higher spending (effect)?</li>
<li class="">Does subscribing to the newsletter (cause) lead to a higher opt-out rate (effect)?</li>
</ol>
</li>
</ul>
<p><strong>2. Defining Target Users and Key Performance Indicators (KPIs)</strong></p>
<ul>
<li class=""><strong>Target</strong>: All active users.</li>
<li class=""><strong>Key Performance Indicators (KPIs)</strong>:<!-- -->
<ol>
<li class="">Total user spending in the 90 days following the observation period.</li>
<li class="">Newsletter opt-out rate.</li>
</ol>
</li>
</ul>
<p><strong>3. Data for Propensity Score Calculation (Covariates)</strong></p>
<ul>
<li class="">To create a fair comparison, we need to account for factors that might influence both the decision to subscribe and the outcomes.</li>
<li class=""><strong>Covariates</strong>: <code>age</code>, <code>region</code>, <code>device_type</code>, <code>past_30_day_sessions</code>, <code>past_30_day_spending</code>.</li>
</ul>
<br>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="analyzing-with-allye">Analyzing with Allye<a href="#analyzing-with-allye" class="hash-link" aria-label="Direct link to Analyzing with Allye" title="Direct link to Analyzing with Allye" translate="no">​</a></h2>
<p>You have collected data on your users, including their characteristics, whether they subscribed, their subsequent spending, and if they opted out.</p>
<p><a href="https://raw.githubusercontent.com/Llenar70/allye-doc/main/course/sample_data/psm_newsletter_data.csv" target="_blank" rel="noopener noreferrer" class="">Download the sample data here</a></p>
<p>Let&#x27;s use Allye to see what the true impact of the newsletter was.</p>
<p><strong>Analysis Steps</strong></p>
<ol>
<li class=""><strong>Load Data</strong>: Drag &amp; Drop your <code>psm_newsletter_data.csv</code> file to the canvas and view it with a <code>Data</code> widget.</li>
</ol>
<p align="center"><img src="/allye-doc/assets/images/course2_get_csv-9b5a626a5e736b3c27e49e0f778f4b94.png" alt="Load Data" style="width:90%;object-fit:contain"></p>
<ol start="2">
<li class=""><strong>EDA: Confirming Selection Bias (Before Matching)</strong>: Let&#x27;s first confirm that subscribers and non-subscribers are different.</li>
</ol>
<ul>
<li class="">Connect a <code>Distribution</code> widget. Select <code>past_30_day_spending</code> as the <em>Variable</em> and <code>subscribed</code> as <em>Split by</em>.</li>
<li class="">You&#x27;ll likely see that the &quot;Subscribed&quot; group already had higher spending in the past. This is the selection bias we need to fix.</li>
</ul>
<p align="center"><img src="/allye-doc/assets/images/course2_eda_before-6c5fd24fb5215ac04f502b832aa598e3.png" alt="Distribution before matching" style="width:75%;object-fit:contain"></p>
<ol start="3">
<li class=""><strong>Apply Propensity Score Matching</strong>: Now, let&#x27;s use PSM to create balanced groups.</li>
</ol>
<ul>
<li class="">Create and connect to the <code>Propensity Score Matching</code> widget.<!-- -->
<ul>
<li class="">Select <code>subscribed</code> as the <code>Treatment Variable</code> and <code>0</code> as the <code>Control Group</code>.</li>
<li class="">Select <code>age</code>, <code>region</code>, <code>device_type</code>, <code>past_30_day_sessions</code>, and <code>past_30_day_spending</code> as the <code>Covariates</code>.</li>
</ul>
</li>
</ul>
<p align="center"><img src="/allye-doc/assets/images/course2_psm_widget-5ac8b74ebcabd151dd64f2a96ac89ca8.png" alt="PSM Widget Setup" style="width:75%;object-fit:contain"></p>
<ul>
<li class="">Select <code>Logistic Regression</code> and <code>L1 (Lasso)</code> in both <code>Model Type</code> and <code>Regularization</code>.</li>
<li class="">You can proceed with the default settings in the <code>Matching Settings</code> area.</li>
<li class="">(optional) If you are unsure about the meaning of any option, click the &quot;Ask&quot; button at the bottom right of the widget to ask AI Allye. She not only understands the widget&#x27;s spec but also has deep expertise in statistical analysis.</li>
</ul>
<p align="center"><img src="/allye-doc/assets/images/course2_configure_psm_widget-ad910860604df0d853f36767d5f0b98d.png" alt="PSM Widget Setup2" style="width:75%;object-fit:contain"></p>
<ol start="4">
<li class=""><strong>Check the Matching Results</strong>: The widget performs the matching and provides several diagnostic tools to assess the quality of the match. A good match is crucial for a reliable causal estimate.<!-- -->
<ul>
<li class=""><strong>Propensity Score Distribution</strong>: First, examine the &quot;Propensity Score Distribution&quot; plots.<!-- -->
<ul>
<li class=""><em>Before Matching</em>: You can see two distinct distributions. The subscribers (Treated) and non-subscribers (Control) have different profiles, confirming the initial selection bias.</li>
<li class=""><em>After Matching</em>: The two distributions now almost completely overlap. This is strong visual evidence that we have created a control group that is very similar to the treatment group in terms of their likelihood to subscribe.</li>
</ul>
</li>
<li class=""><strong>Covariate Balance (Love Plot)</strong>: Next, look at the &quot;Covariate Balance&quot; plot (often called a Love Plot). This plot shows the &quot;Standardized Mean Difference&quot; (SMD) for each covariate before and after matching. A smaller SMD means the groups are more similar.<!-- -->
<ul>
<li class=""><em>Before Matching (Orange Dots)</em>: You can see that variables like <code>past_30_day_spending</code> and <code>past_30_day_sessions</code> have a large SMD, indicating significant imbalance.</li>
<li class=""><em>After Matching (Blue Dots)</em>: All dots are now very close to the zero line. This confirms that the matching process has successfully balanced the characteristics between the treatment and control groups. PSM was successful!</li>
</ul>
</li>
</ul>
</li>
</ol>
<p align="center"><img src="/allye-doc/assets/images/course2_psm_result-24e6036ec8cd50b5f2b0eafebeb6ce99.png" alt="Propensity Score Distribution before and after matching" style="width:75%;object-fit:contain"></p>
<ol start="5">
<li class=""><strong>Estimate Causal Effect</strong>: Now that we are confident in our matched groups, we can proceed to estimate the causal effect.</li>
</ol>
<ul>
<li class="">Create and connect to the <code>AB Test</code> widget. Select <code>Matched Data</code> in <code>Edit Links</code> dialog.</li>
</ul>
<p align="center"><img src="/allye-doc/assets/images/course2_abtest-a877482d615583390ff113f434c64e64.png" alt="AB Test for Matched Data" style="width:50%;object-fit:contain"></p>
<ul>
<li class="">Configure AB Test widget as shown in the image below and check the results.</li>
</ul>
<p align="center"><img src="/allye-doc/assets/images/course2_abtest_result-64f8e80616220a1d315637b3669c3378.png" alt="AB Test for Matched Data" style="width:60%;object-fit:contain"></p>
<ul>
<li class=""><strong>Causal Effect on Spending</strong>: We set <code>future_spending</code> as the <code>Target Variable</code>. With Matching Target set to &quot;Align to Treated (ATT)&quot; (the default), the result is interpreted as <strong>ATT (Average Treatment Effect on the Treated)</strong>. In our example run, the effect is +2.6% with a high p-value of 0.25, indicating <strong>no statistically significant impact</strong> on user spending. The newsletter does not cause users to spend more.</li>
<li class=""><strong>Causal Effect on Opt-Out Rate</strong>: We also set <code>opted_out</code>. Here, the result is starkly different. The p-value far below 0.05. This is a statistically significant result, indicating that subscribing to the newsletter <em>increases</em> the probability of a user opting out.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="making-decisions">Making Decisions<a href="#making-decisions" class="hash-link" aria-label="Direct link to Making Decisions" title="Direct link to Making Decisions" translate="no">​</a></h2>
<p>Our analysis provides a clear, data-driven story:</p>
<ol>
<li class=""><strong>Selection Bias Was Present</strong>: We confirmed that subscribers were initially different from non-subscribers. A naive comparison would have been misleading.</li>
<li class=""><strong>PSM Created a Fair Comparison</strong>: The matching process successfully created a balanced control group.</li>
<li class=""><strong>The Newsletter Failed</strong>: After balancing the groups, we found two key results:</li>
</ol>
<ul>
<li class="">It has <strong>no causal impact on sales</strong>.</li>
<li class="">It causes a <strong>statistically significant increase in opt-outs</strong>.</li>
</ul>
<p>With this evidence, you can confidently state:</p>
<p>&quot;After correcting for selection bias, our analysis shows the newsletter has no impact on user spending. Worse, it directly causes a 9–17% increase in the opt-out rate, meaning we are actively driving users away. The current strategy is not working. The decision is to <strong>halt the current newsletter campaign and re-evaluate its content and frequency</strong> to provide more value and reduce user churn.&quot;</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="real-world-hurdles-and-beyond">Real-World Hurdles and Beyond<a href="#real-world-hurdles-and-beyond" class="hash-link" aria-label="Direct link to Real-World Hurdles and Beyond" title="Direct link to Real-World Hurdles and Beyond" translate="no">​</a></h2>
<p>PSM is a fantastic tool, but it&#x27;s not magic. It has one major limitation:</p>
<ul>
<li class=""><strong>Unobserved Confounding</strong>: PSM can only balance the variables you <em>observe</em>. If there&#x27;s a critical, unobserved factor that influences both subscribing and the outcomes (e.g., a user&#x27;s underlying &quot;brand loyalty&quot;), your results could still be biased. This is the key advantage of an RCT, which balances <em>both known and unknown</em> confounders.</li>
</ul>
<p>Our analysis of the <em>average</em> effect led us to pause the campaign. But what if the newsletter was actually very effective for a small segment of users, while being ineffective or annoying for the majority? If we could identify that successful segment, we could create a more targeted, valuable campaign. To answer this, we need to understand the <strong>heterogeneous effect</strong>—how the impact varies across different users. This is where we move beyond average impacts.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/Llenar70/allye-doc/tree/main/web-docs/docs/tutorial-advanced/Quasi_experimental_Analysis.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/allye-doc/docs/tutorial-advanced/Survey_Analysis"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Survey Analysis</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/allye-doc/docs/tutorial-advanced/Machine_Learning_Prototyping"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Machine learning predictive model prototyping</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-challenge-apples-to-oranges-comparison" class="table-of-contents__link toc-highlight">The Challenge: Apples to Oranges Comparison</a></li><li><a href="#the-solution-propensity-score-matching-psm" class="table-of-contents__link toc-highlight">The Solution: Propensity Score Matching (PSM)</a></li><li><a href="#designing-the-analysis-does-a-newsletter-increase-sales-or-just-annoy-users" class="table-of-contents__link toc-highlight">Designing the Analysis: Does a Newsletter Increase Sales or Just Annoy Users?</a></li><li><a href="#analyzing-with-allye" class="table-of-contents__link toc-highlight">Analyzing with Allye</a></li><li><a href="#making-decisions" class="table-of-contents__link toc-highlight">Making Decisions</a></li><li><a href="#real-world-hurdles-and-beyond" class="table-of-contents__link toc-highlight">Real-World Hurdles and Beyond</a></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>